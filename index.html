<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel='stylesheet' id='app'  href='app.css?version=2.2' type='text/css' media='all' />
    <link rel='stylesheet' id='toastr'  href='https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css' type='text/css' media='all' />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha512-z4OUqw38qNLpn1libAN9BsoDx6nbNFio5lA6CuTp9NlK83b89hgyCVq+N5FdBJptINztxn1Z3SaKSKUS5UP60Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.25.0/axios.min.js" integrity="sha512-/Q6t3CASm04EliI1QyIDAA/nDo9R8FQ/BULoUFyN4n/BDdyIxeH7u++Z+eobdmr11gG5D/6nPFyDlnisDwhpYA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/comfy.js@latest/dist/comfy.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <title>Aleexgod Twitch Overlay</title>
  </head>
  <body>
  
    <canvas id="fireworks"></canvas>
    <div id="peeporun"></div>
    <div id="banned"><div class="text"></div></div>
    <div id="controller"><div class="text">Skilled BTW</div> </div>

	<script>
    // let c = document.getElementById('fireworks');
    // var gl = c.getContext( 'webgl', { preserveDrawingBuffer: true } )
    //   ,	w = c.width = window.innerWidth
    //   ,	h = c.height = window.innerHeight

    //   ,	webgl = {}
    //   ,	opts = {
    //     projectileAlpha: .8,
    //     projectileLineWidth: 1.3,
    //     fireworkAngleSpan: .5,
    //     baseFireworkVel: 3,
    //     addedFireworkVel: 3,
    //     gravity: .03,
    //     lowVelBoundary: -.2,
    //     xFriction: .995,
    //     baseShardVel: 1,
    //     addedShardVel: .2,
    //     fireworks: 1000,
    //     baseShardsParFirework: 10,
    //     addedShardsParFirework: 10,
    //     shardFireworkVelMultiplier: .3,
    //     initHueMultiplier: 1/360,
    //     runHueAdder: .1/360
    //   }

    // webgl.vertexShaderSource = `
    // uniform int u_mode;
    // uniform vec2 u_res;
    // attribute vec4 a_data;
    // varying vec4 v_color;

    // vec3 h2rgb( float h ){
    //   return clamp( abs( mod( h * 6. + vec3( 0, 4, 2 ), 6. ) - 3. ) -1., 0., 1. );
    // }
    // void clear(){
    //   gl_Position = vec4( a_data.xy, 0, 1 );
    //   v_color = vec4( 0, 0, 0, a_data.w );
    // }
    // void draw(){
    //   gl_Position = vec4( vec2( 1, -1 ) * ( ( a_data.xy / u_res ) * 2. - 1. ), 0, 1 );
    //   v_color = vec4( h2rgb( a_data.z ), a_data.w );
    // }
    // void main(){
    //   if( u_mode == 0 )
    //     draw();
    //   else
    //     clear();
    // }
    // `;
    // webgl.fragmentShaderSource = `
    // precision mediump float;
    // varying vec4 v_color;

    // void main(){
    //   gl_FragColor = v_color;
    // }
    // `;

    // webgl.vertexShader = gl.createShader( gl.VERTEX_SHADER );
    // gl.shaderSource( webgl.vertexShader, webgl.vertexShaderSource );
    // gl.compileShader( webgl.vertexShader );

    // webgl.fragmentShader = gl.createShader( gl.FRAGMENT_SHADER );
    // gl.shaderSource( webgl.fragmentShader, webgl.fragmentShaderSource );
    // gl.compileShader( webgl.fragmentShader );

    // webgl.shaderProgram = gl.createProgram();
    // gl.attachShader( webgl.shaderProgram, webgl.vertexShader );
    // gl.attachShader( webgl.shaderProgram, webgl.fragmentShader );

    // gl.linkProgram( webgl.shaderProgram );
    // gl.useProgram( webgl.shaderProgram );

    // webgl.dataAttribLoc = gl.getAttribLocation( webgl.shaderProgram, 'a_data' );
    // webgl.dataBuffer = gl.createBuffer();

    // gl.enableVertexAttribArray( webgl.dataAttribLoc );
    // gl.bindBuffer( gl.ARRAY_BUFFER, webgl.dataBuffer );
    // gl.vertexAttribPointer( webgl.dataAttribLoc, 4, gl.FLOAT, false, 0, 0 );

    // webgl.resUniformLoc = gl.getUniformLocation( webgl.shaderProgram, 'u_res' );
    // webgl.modeUniformLoc = gl.getUniformLocation( webgl.shaderProgram, 'u_mode' );

    // gl.viewport( 0, 0, w, h );
    // gl.uniform2f( webgl.resUniformLoc, w, h );

    // gl.blendFunc( gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA );
    // gl.enable( gl.BLEND );

    // gl.lineWidth( opts.projectileLineWidth );

    // webgl.data = [];

    // webgl.clear = function(){
      
    //   gl.uniform1i( webgl.modeUniformLoc, 1 );
    //   var a = .1;
    //   webgl.data = [
    //     -1, -1, 0, a,
    //     1, -1, 0, a,
    //     -1,  1, 0, a,
    //     -1,  1, 0, a,
    //     1, -1, 0, a,
    //     1,  1, 0, a
    //   ];
    //   webgl.draw( gl.TRIANGLES );
    //   gl.uniform1i( webgl.modeUniformLoc, 0 );
    //   webgl.data.length = 0;
    // }
    // webgl.draw = function( glType ){
      
    //   gl.bufferData( gl.ARRAY_BUFFER, new Float32Array( webgl.data ), gl.STATIC_DRAW );
    //   gl.drawArrays( glType, 0, webgl.data.length / 4 );
    // }

    // var	fireworks = []
    //   ,	tick = 0
    //   ,	sins = []
    //   ,	coss = []
    //   ,	maxShardsParFirework = opts.baseShardsParFirework + opts.addedShardsParFirework
    //   ,	tau = 6.283185307179586476925286766559;

    // for( var i = 0; i < maxShardsParFirework; ++i ){
    //   sins[ i ] = Math.sin( tau * i / maxShardsParFirework );
    //   coss[ i ] = Math.cos( tau * i / maxShardsParFirework );
    // }

    // function Firework(){
    //   this.reset();
    //   this.shards = [];
    //   for( var i = 0; i < maxShardsParFirework; ++i )
    //     this.shards.push( new Shard( this ) );
    // }
    // Firework.prototype.reset = function(){
      
    //   var angle = -Math.PI / 2 + ( Math.random() - .5 )* opts.fireworkAngleSpan
    //     ,	vel = opts.baseFireworkVel + opts.addedFireworkVel * Math.random();
      
    //   this.mode = 0;
    //   this.vx = vel * Math.cos( angle );
    //   this.vy = vel * Math.sin( angle );
      
    //   this.x = Math.random() * w;
    //   this.y = h;
      
    //   this.hue = tick * opts.initHueMultiplier;
      
    // }
    // Firework.prototype.step = function(){
      
    //   if( this.mode === 0 ){
        
    //     var ph = this.hue
    //       ,	px = this.x
    //       ,	py = this.y;
        
    //     this.hue += opts.runHueAdder;
      
    //     this.x += this.vx *= opts.xFriction;
    //     this.y += this.vy += opts.gravity;
        
    //     webgl.data.push(
    //       px, py, ph, opts.projectileAlpha * .2,
    //       this.x, this.y, this.hue, opts.projectileAlpha * .2 );
        
    //     if( this.vy >= opts.lowVelBoundary ){
    //       this.mode = 1;

    //       this.shardAmount = opts.baseShardsParFirework + opts.addedShardsParFirework * Math.random() | 0;

    //       var baseAngle = Math.random() * tau
    //         ,	x = Math.cos( baseAngle )
    //         ,	y = Math.sin( baseAngle )
    //         ,	sin = sins[ this.shardAmount ]
    //         ,	cos = coss[ this.shardAmount ];

    //       for( var i = 0; i < this.shardAmount; ++i ){

    //         var vel = opts.baseShardVel + opts.addedShardVel * Math.random();
    //         this.shards[ i ].reset( x * vel, y * vel )
    //         var X = x;
    //         x = x * cos - y * sin;
    //         y = y * cos + X * sin;
    //       }
    //     }

    //   } else if( this.mode === 1 ) {
        
    //     this.ph = this.hue
    //     this.hue += opts.runHueAdder;
        
    //     var allDead = true;
    //     for( var i = 0; i < this.shardAmount; ++i ){
    //       var shard = this.shards[ i ];
    //       if( !shard.dead ){
    //         shard.step();
    //         allDead = false;
    //       }
    //     }
        
    //     if( allDead )
    //       this.reset();
    //   }
      
    // }
    // function Shard( parent ){
    //   this.parent = parent;
    // }
    // Shard.prototype.reset = function( vx, vy ){
    //   this.x = this.parent.x;
    //   this.y = this.parent.y;
    //   this.vx = this.parent.vx * opts.shardFireworkVelMultiplier + vx;
    //   this.vy = this.parent.vy * opts.shardFireworkVelMultiplier + vy;
    //   this.starty = this.y;
    //   this.dead = false;
    //   this.tick = 1;
    // }
    // Shard.prototype.step = function(){
      
    //   this.tick += .05;
      
    //   var px = this.x
    //     ,	py = this.y;
      
    //   this.x += this.vx *= opts.xFriction;
    //   this.y += this.vy += opts.gravity;
      
    //   var proportion = 1 - ( this.y - this.starty ) / ( h - this.starty );
      
    //   webgl.data.push(
    //     px, py, this.parent.ph, opts.projectileAlpha / this.tick,
    //     this.x, this.y, this.parent.hue, opts.projectileAlpha / this.tick );
      
    //   if( this.y > h )
    //     this.dead = true;
    // }

    // function anim(){
      
    //   window.requestAnimationFrame( anim )
      
    //   webgl.clear();
      
    //   ++tick;
      
    //   if( fireworks.length < opts.fireworks )
    //     fireworks.push( new Firework );
      
    //   fireworks.map( function( firework ){ firework.step(); } );
      
    //   webgl.draw( gl.LINES );
    // }

		const chatbox = document.querySelector('#chatbox');

  //   var clientId = "8jx1yydxfqpa4egqlf4zmob4p83qqq";
  //   var twitchAuthPass = "oauth:xlmpdwgcbdbiciupv0l721yo2z0747";
  //   var clientPass = "vq900qoi5qwja16uqwjbw9vhwul8ai";

  //   async function getRewards() {
  //     let channelRewards = await ComfyJS.GetChannelRewards( clientId, true );
  //   }
  //   async function createCustomReward() {
  //   let customReward = await ComfyJS.CreateChannelReward( clientId, {
  //       title: "Test Reward",
  //       prompt: "Test Description",
  //       cost: 100,
  //       is_enabled: true,
  //       background_color: "#00E5CB",
  //       is_user_input_required: false,
  //       is_max_per_stream_enabled: false,
  //       max_per_stream: 0,
  //       is_max_per_user_per_stream_enabled: false,
  //       max_per_user_per_stream: 0,
  //       is_global_cooldown_enabled: false,
  //       global_cooldown_seconds: 0,
  //       should_redemptions_skip_request_queue: true
  //   } );
  // }

// 93cd8382-21a1-4cbd-a3bf-8dee10475431 <-- rewardid

    ComfyJS.onCommand = ( user, command, message, flags, extra ) => {
        if( flags.broadcaster && command === "green" ) {
          fetch('https://gentle-eyrie-49527.herokuapp.com/maker.ifttt.com/trigger/change_green/with/key/cvKnW3w0ovrX3aQLGqCmqr')
            .then((response) => {
              toastr.success('light changed green');
            });
        } else if( flags.broadcaster && command === "purple" ) {
          fetch('https://gentle-eyrie-49527.herokuapp.com/maker.ifttt.com/trigger/change_purple/with/key/cvKnW3w0ovrX3aQLGqCmqr')
            .then((response) => {
              toastr.success('light changed to purple');
            });
        }
        else if(command === "run") {
          $('#peeporun').addClass('running');
          setTimeout(function() {
            $('#peeporun').removeClass('running')
          }, 5000);
        }
        else if(command === "controller") {
          controller();
        }
        else if(command === "fireworks") {
          var canvas = document.body.appendChild(document.createElement("canvas"));
          canvas.setAttribute("id", "fireworks");
          anim();
          setTimeout(function() {
            $('#fireworks').fadeOut();
          }, 6000);
        }
    }

    ComfyJS.onChat = ( user, message, flags, self, extra ) => {
      console.log( user, message.toLowerCase() );
      if( flags.customReward && extra.customRewardId === "93cd8382-21a1-4cbd-a3bf-8dee10475431" ) {
        if( message.toLowerCase() === "green") {
          fetch('https://gentle-eyrie-49527.herokuapp.com/maker.ifttt.com/trigger/change_green/with/key/cvKnW3w0ovrX3aQLGqCmqr')
            .then((response) => {
              toastr.success('light changed green');
            });
        } else if ( message.toLowerCase() === "purple" ) {
          fetch('https://gentle-eyrie-49527.herokuapp.com/maker.ifttt.com/trigger/change_purple/with/key/cvKnW3w0ovrX3aQLGqCmqr')
            .then((response) => {
              toastr.success('light changed to purple');
            });
        } else if ( message.toLowerCase() === "blue" ) {
          fetch('https://gentle-eyrie-49527.herokuapp.com/maker.ifttt.com/trigger/change_blue/with/key/cvKnW3w0ovrX3aQLGqCmqr')
            .then((response) => {
              toastr.success('light changed to blue');
            });
        } else if ( message.toLowerCase() === "red" ) {
          fetch('https://gentle-eyrie-49527.herokuapp.com/maker.ifttt.com/trigger/change_red/with/key/cvKnW3w0ovrX3aQLGqCmqr')
            .then((response) => {
              toastr.success('light changed to red');
            });
        } else {
          fetch('https://gentle-eyrie-49527.herokuapp.com/maker.ifttt.com/trigger/change_blue/with/key/cvKnW3w0ovrX3aQLGqCmqr')
            .then((response) => {
              toastr.success('light changed to blue');
            });
        }
      }
    }



    function bannedUserAnim(bannedUsername) {
      $('#banned').addClass('active');
      setTimeout(function() {
        $('#banned .text').text(bannedUsername);
      }, 2500);
      setTimeout(function() {
        $('#banned').removeClass('active');
        $('#banned .text').text('');
      }, 4080);
    };


    function controller() {
      $('#controller').fadeIn(300);
      setTimeout(function() {
        $('#controller').fadeOut(200);
      }, 3870);
    }

    ComfyJS.onBan = ( bannedUsername, extra ) => {
        bannedUserAnim(bannedUsername);
    }

    ComfyJS.onReward = ( user, reward, cost, message, extra ) => {
      console.log( user + " redeemed " + reward + " for " + cost );
    }    

    ComfyJS.Init( 'aleexgod', 'oauth:xlmpdwgcbdbiciupv0l721yo2z0747' );
    // ALEX GAVE ME THIS OAUTH xlmpdwgcbdbiciupv0l721yo2z0747
		// ComfyJS.Init('wintrfox');
	</script>
  </body>
</html>